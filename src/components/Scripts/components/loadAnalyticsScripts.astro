---
---
<script>
(function() {
    const e = document.querySelector("#scripts_json");

    var scripts_json = {};
    if (e && e.textContent) {
        scripts_json = JSON.parse(e.textContent)
    }

    var analyticsLoaded = false;

    function loadAnalyticsScripts() {
        if (!analyticsLoaded) {
            analyticsLoaded = true;
            window.removeEventListener('scroll', loadAnalyticsScripts);
            document.removeEventListener('mousemove', loadAnalyticsScripts);

            // Проходим по всем ключам в JSON
            Object.keys(scripts_json).forEach(key => {
                if (key === 'site') return; // Пропускаем служебные ключи
                
                const config = scripts_json[key];
                
                // Проверяем структуру конфигурации
                if (!config || typeof config !== 'object' || !config.fn || !config.value) return;
                
                // Проверка на production окружение
                if (config.prod && process.env.NODE_ENV !== "production") return;
                
                // Проверка существования функции
                if (typeof window[config.fn] !== 'function') return;
                
                try {
                    // Запускаем функцию с данными
                    window[config.fn](config.value);
                } catch (error) {
                    console.error(`Ошибка при запуске ${config.fn}:`, error);
                }
            });
        }
    }

    function initializeEventListeners() {
        // console.log("initializeEventListeners", analyticsLoaded);
        window.addEventListener('scroll', loadAnalyticsScripts);
        document.addEventListener('mousemove', loadAnalyticsScripts);
    }

    // console.log("document.readyState", document.readyState);
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initializeEventListeners);
    } else {
        initializeEventListeners();
    }
})();
</script>
